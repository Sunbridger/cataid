# 客服功能部署与使用指南

恭喜！客服功能的核心代码已经 implementation 完成。为了让它正常工作，请务必按照以下步骤进行配置。

## 1. 数据库初始化 (必须)

由于服务端无法自动执行复杂的 SQL 脚本，你需要手动在 Supabase 控制台执行初始化脚本。

1.  登录 [Supabase Dashboard](https://supabase.com/dashboard)。
2.  进入你的项目 -> **SQL Editor**。
3.  点击 **"New query"**。
4.  复制项目根目录下 `create_support_tables.sql` 文件的所有内容。
5.  粘贴到编辑器中，点击 **Run**。
    *   *预期结果：右下角显示 "Success"，无报错。*

## 2. 环境变量配置 (关键)

为了让前端能够接收实时消息 (Realtime)，你需要配置前端环境变量。

1.  打开项目根目录下的 `.env.local` 文件。
2.  添加以下两行配置（替换为你实际的 Supabase 项目信息）：

```env
# Supabase 前端配置 (用于 Realtime)
# 这些变量会暴露给前端，请只填 anon key，不要填 service_role_key！
VITE_SUPABASE_URL=https://your-project-url.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

*   *如何获取？*
    *   Dashboard -> Project Settings -> API -> Project URL / API Keys (anon public)。

## 3. 功能验证

完成以上两步后：

1.  重启本地开发服务器 (`npm run dev`)。
2.  登录任意用户账号。
3.  进入 **个人中心 -> 服务中心 -> 在线客服**。
4.  尝试发送一条消息。
    *   *成功标志：消息发送成功，并且再次进入时能看到历史记录。*

## 4. 管理员回复功能

我们在第一阶段已经集成了基础的管理员回复功能：

1.  登录管理员账号。
2.  进入 `/admin` 管理页面。
3.  点击顶部的 **"客服消息"** 标签页。
4.  这里会显示所有用户的咨询会话列表。
5.  点击任意会话，将在新窗口中打开聊天界面，你可以在此以管理员身份回复用户。

*注意：管理员模式下的聊天窗口会自动加载对应用户的历史消息。*

